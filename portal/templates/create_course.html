{% extends "admin_base.html" %}
{% import "bootstrap/fixes.html" as fixes %}

{% block title %}
智益加 - 新增课程
{% endblock %}

{% block content %}
<div class='container'>
	<div class="panel panel-default">
	  	
	  	<div class="panel-body">
			<div class="row row-padding">
	  			<div class="col-lg-1" align='right'>
				    <span class='group-info'>课程编号</span><strong class='info-nessecary'>*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_id' type="text" class="form-control" readonly placeholder='由服务端生成'></input>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>名称</span><strong class='info-nessecary'>*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_name' type="text" class="form-control" placeholder='输入课程名称'></input>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>招生对象</span><strong class='info-nessecary'>*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_target' type="text" class="form-control" placeholder='输入课程招生对象'></input>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>课程类型</span><strong class='info-nessecary'>*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<div class="dropdown">
  						<button id='btn_create_course_gtype' class="btn btn-default dropdown-toggle" type="button" 
  							data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">请选择课程类型
    						<span class="caret"></span>
  						</button>
					    <ul class="dropdown-menu" aria-labelledby="btn_create_course_gtype">
					    	{% for gtype in types %}
						    <li onclick="select_gtype('{{gtype.type}}', '{{gtype.name}}')"><a>{{gtype.name}}</a></li>
						    {% endfor %}
					    </ul>
					</div>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>时间安排</span><strong class='info-nessecary'>*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_time' type="text" class="form-control" placeholder='输入课程时间安排'></input>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>课时次数</span><strong class='info-nessecary'>*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_count' type="number" class="form-control" placeholder='输入课时次数'></input>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>试听次数</span><strong class='info-nessecary'>*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_audition' type="number" class="form-control" placeholder='输入可试听的次数'></input>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>课时时长</span><strong class='info-nessecary'>*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_period' type="number" class="form-control" placeholder='输入课时时长，单位分钟'></input>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>最少人数</span><strong class='info-nessecary'>*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_min' type="number" class="form-control" placeholder='输入最少学生人数'></input>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>最多人数</span><strong class='info-nessecary'>*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_max' type="number" class="form-control" placeholder='输入最多学生人数'></input>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>报名费</span><strong class='info-nessecary'>*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_fee' type="number" class="form-control" placeholder='输入报名费用，单位元'></input>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>介绍信息</span><strong style="visibility:hidden">*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_desc' type="text" class="form-control"></input>
			  	</div>
			</div>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'>
				    <span class='group-info'>其他信息</span><strong style="visibility:hidden">*</strong>
			  	</div>
				<div class="col-lg-5" align='left'>
					<input id='create_course_extend' type="text" class="form-control"></input>
			  	</div>
			</div>

			<hr/>

			<div class="row row-padding">
			  	<div class="col-lg-1" align='right'></div>
				<div class="col-lg-2">
					<button id='btn_create_course' class='btn btn-primary full'>提交</button>
			  	</div>
			</div>
		</div>
	</div>
</div>

<script src="/static/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script src="/static/js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<script type="text/javascript">
    function select_gtype(type, name) {
    	$("#btn_create_course_gtype").val(type);
		$("#btn_create_course_gtype").html(name + " <span class='caret'></span>");
    }
    $("#btn_create_course").bind("click", function() {
    	var name = document.getElementById("create_course_name").value;
    	if (empty_input(name)) {
			$.MsgBox.Alert("非法输入", "请输入课程名称");
			return;
		}

		var target = document.getElementById("create_course_target").value;
    	if (empty_input(target)) {
			$.MsgBox.Alert("非法输入", "请输入招生对象");
			return;
		}

		var gtype = document.getElementById("btn_create_course_gtype").value;
		if (empty_input(gtype)) {
			$.MsgBox.Alert("非法输入", "请选择课程类型");
			return;
		}

		var time = document.getElementById("create_course_time").value;
		if (empty_input(time)) {
			$.MsgBox.Alert("非法输入", "请选择课程时间安排");
			return;
		}

		var count = document.getElementById("create_course_count").value;
		if (empty_input(count)) {
			$.MsgBox.Alert("非法输入", "请输入课程次数");
			return;
		}

		var audition = document.getElementById("create_course_audition").value;
		if (empty_input(audition)) {
			$.MsgBox.Alert("非法输入", "请输入课程试听次数");
			return;
		}

		var period = document.getElementById("create_course_period").value;
		if (empty_input(period)) {
			$.MsgBox.Alert("非法输入", "请输入课程单次时长");
			return;
		}

		var min = document.getElementById("create_course_min").value;
		if (empty_input(min)) {
			$.MsgBox.Alert("非法输入", "请输入课程最少学生人数");
			return;
		}

		var max = document.getElementById("create_course_max").value;
		if (empty_input(max)) {
			$.MsgBox.Alert("非法输入", "请输入课程最多学生人数");
			return;
		}

		var fee = document.getElementById("create_course_fee").value;
		if (empty_input(fee)) {
			$.MsgBox.Alert("非法输入", "请输入课程收费金额");
			return;
		}

		var desc = document.getElementById("create_course_desc").value;
		var extend = document.getElementById("create_course_extend").value;
	    
		$.ajax({
			url:'/rest/create_course',
		    data: {
		    	"summary": JSON.stringify({
			    	"name": name,
			    	"target": target,
			    	"gtype": gtype,
			    	"time": time,
			    	"count": count,
			    	"audition": audition,
			    	"period": period,
			    	"min": min,
			    	"max": max,
			    	"charge": fee,
			    	"desc": desc,
			    	"extend": extend
			    })
		    },
		    type: 'post',
		    cache: false,
		    dataType: 'json',
		    success: function(data) {
		    	if (data["error"] == 0) {
		    		$("#create_course_id").val(data["cid"]);
			    	$.MsgBox.Alert("新增课程", "您的请求已提交成功", function() {
			    		window.location.href = "/course";
			    	});
			    } else {
			    	$.MsgBox.Alert("新增课程", data["cause"]);
			    }
		    },
		    error: function() {
		        $.MsgBox.Alert("新增课程", "请求失败，请稍候重试");
		    }
		})
    });
</script>
{% endblock %}

{% block head %}
{{super()}}
{{fixes.ie8()}}
{% endblock %}
